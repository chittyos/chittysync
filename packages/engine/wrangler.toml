name = "chittysync"
main = "src/worker.ts"
compatibility_date = "2024-12-01"
compatibility_flags = ["nodejs_compat"]

# Production: sync.chitty.cc
[env.production]
routes = [
  { pattern = "sync.chitty.cc", custom_domain = true }
]

[env.production.vars]
ENVIRONMENT = "production"
CHITTY_SCHEMA_URL = "https://schema.chitty.cc"
CHITTY_LEDGER_URL = "https://ledger.chitty.cc"
CHITTY_AUTH_URL = "https://auth.chitty.cc"

# Staging: sync-staging.chitty.cc
[env.staging]
routes = [
  { pattern = "sync-staging.chitty.cc", custom_domain = true }
]

[env.staging.vars]
ENVIRONMENT = "staging"
CHITTY_SCHEMA_URL = "https://schema.chitty.cc"
CHITTY_LEDGER_URL = "https://ledger.chitty.cc"
CHITTY_AUTH_URL = "https://auth.chitty.cc"

# Development
[env.development]
vars = { ENVIRONMENT = "development" }

# Secrets (set via wrangler secret put):
# - DATABASE_URL: Neon PostgreSQL connection string
# - NOTION_API_TOKEN: Notion integration token
# - GOOGLE_SERVICE_ACCOUNT: Google Sheets service account JSON
# - ENGINE_PUBKEY_HEX: Ed25519 public key for verification

# Scheduled sync triggers
[triggers]
crons = [
  "*/5 * * * *"   # Every 5 minutes for real-time tier
]
